{"ast":null,"code":"import _regeneratorRuntime from \"/home/server/Escritorio/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _slicedToArray from \"/home/server/Escritorio/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/home/server/Escritorio/frontend/src/componets/commons/auth/auth-context.js\";\nimport React, { useState, useContext } from \"react\";\nimport { useHistory } from \"react-router-dom\";\nimport { login } from \"../../axios/login\";\nimport { register } from \"../../axios/register\"; // 1) Creamos el contexto\n\nvar AuthContext = React.createContext(); // Recuperamos el token del localStorage ya que si el usuario\n// refresca la página del navegador necesito iniciar la aplicación\n// con un estado autenticado\n\nvar currentUser = JSON.parse(localStorage.getItem(\"currentUser\"));\nvar currentToken = JSON.parse(localStorage.getItem(\"currentToken\")); // 2) Creamos el custom Provider\n\nexport function AuthProvider(_ref) {\n  var children = _ref.children;\n\n  // 2.1) Creamos Estados\n  // En caso de que trabaje con roles deberia decodificar el token para obtener el role inicial\n  // const [role, setRole] = useState(decodeTokenAndGetRole(currentUser.token));\n  var _useState = useState(currentUser !== null),\n      _useState2 = _slicedToArray(_useState, 2),\n      isAuthenticated = _useState2[0],\n      setIsAuthenticated = _useState2[1];\n\n  var _useState3 = useState(currentUser && currentUser.user),\n      _useState4 = _slicedToArray(_useState3, 2),\n      user = _useState4[0],\n      setUser = _useState4[1];\n\n  var _useState5 = useState(currentToken && currentToken.token),\n      _useState6 = _slicedToArray(_useState5, 2),\n      token = _useState6[0],\n      setToken = _useState6[1];\n\n  var history = useHistory(); // 2.2) Definiremos los métodos para modificar el estado\n  // Login => Cambiaré a true mi estado\n  // Si trabajo con roles puedo establecer el role a través de la decodificación del token\n\n  var singIN = function singIN(_ref2) {\n    var email, password, _ref3, _ref3$data, accessToken, expireIN;\n\n    return _regeneratorRuntime.async(function singIN$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            email = _ref2.email, password = _ref2.password;\n            _context.prev = 1;\n            _context.next = 4;\n            return _regeneratorRuntime.awrap(login(email, password));\n\n          case 4:\n            _ref3 = _context.sent;\n            _ref3$data = _ref3.data;\n            accessToken = _ref3$data.accessToken;\n            expireIN = _ref3$data.expireIN;\n            setUser(email);\n            setToken(accessToken);\n            setIsAuthenticated(true);\n\n            if (accessToken) {\n              if (email == \"admin@yopmail.com\") {\n                history.push(\"/admin\");\n              } else {\n                history.push(\"/user\");\n              }\n            }\n\n            _context.next = 17;\n            break;\n\n          case 14:\n            _context.prev = 14;\n            _context.t0 = _context[\"catch\"](1);\n            return _context.abrupt(\"return\", Promise.reject(_context.t0));\n\n          case 17:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, [[1, 14]]);\n  }; // Register => Cambiaré a true mi estado\n\n\n  var signUp = function signUp(_ref4) {\n    var firstName, lastName, email, password, gender, dob, address, postalCode, phone, bornIn;\n    return _regeneratorRuntime.async(function signUp$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            firstName = _ref4.firstName, lastName = _ref4.lastName, email = _ref4.email, password = _ref4.password, gender = _ref4.gender, dob = _ref4.dob, address = _ref4.address, postalCode = _ref4.postalCode, phone = _ref4.phone, bornIn = _ref4.bornIn;\n            _context2.prev = 1;\n            _context2.next = 4;\n            return _regeneratorRuntime.awrap(register({\n              firstName: firstName,\n              lastName: lastName,\n              email: email,\n              password: password,\n              gender: gender,\n              dob: dob,\n              address: address,\n              postalCode: postalCode,\n              phone: phone,\n              bornIn: bornIn\n            }));\n\n          case 4:\n            ;\n            window.alert(\"Su registro a sido un exito\");\n            history.push(\"/\");\n            _context2.next = 12;\n            break;\n\n          case 9:\n            _context2.prev = 9;\n            _context2.t0 = _context2[\"catch\"](1);\n            return _context2.abrupt(\"return\", Promise.reject(_context2.t0));\n\n          case 12:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, [[1, 9]]);\n  }; // Logout => Cambiaré a false mi estado\n\n\n  var logout = function logout() {\n    setUser(null);\n    setIsAuthenticated(false);\n    localStorage.removeItem(\"currentUser\");\n  }; // 2.3) Devolvemos el Context\n  // Si usara roles puedo devolver el role actual del usuario en lugar de isAuthenticated\n  // return (\n  //   <AuthContext.Provider\n  //     value={{ role, setRole, signIn, user }}\n  //   >\n  //     {children}\n  //   </AuthContext.Provider>\n  // );\n\n\n  return React.createElement(AuthContext.Provider, {\n    value: {\n      isAuthenticated: isAuthenticated,\n      setIsAuthenticated: setIsAuthenticated,\n      singIN: singIN,\n      user: user,\n      token: token,\n      signUp: signUp,\n      logout: logout\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 102\n    },\n    __self: this\n  }, children);\n} // 3) Crear el custom hook\n// Es lo que usaré en los componentes para acceder al value del contexto\n\nexport function useAuth() {\n  var context = useContext(AuthContext);\n  return context;\n}","map":{"version":3,"sources":["/home/server/Escritorio/frontend/src/componets/commons/auth/auth-context.js"],"names":["React","useState","useContext","useHistory","login","register","AuthContext","createContext","currentUser","JSON","parse","localStorage","getItem","currentToken","AuthProvider","children","isAuthenticated","setIsAuthenticated","user","setUser","token","setToken","history","singIN","email","password","data","accessToken","expireIN","push","Promise","reject","signUp","firstName","lastName","gender","dob","address","postalCode","phone","bornIn","window","alert","logout","removeItem","useAuth","context"],"mappings":";;;AAAA,OAAOA,KAAP,IAAgBC,QAAhB,EAA0BC,UAA1B,QAA4C,OAA5C;AACA,SAASC,UAAT,QAA2B,kBAA3B;AACA,SAASC,KAAT,QAAsB,mBAAtB;AACA,SAASC,QAAT,QAAyB,sBAAzB,C,CAEA;;AACA,IAAMC,WAAW,GAAGN,KAAK,CAACO,aAAN,EAApB,C,CAGA;AACA;AACA;;AACA,IAAMC,WAAW,GAAGC,IAAI,CAACC,KAAL,CAAWC,YAAY,CAACC,OAAb,CAAqB,aAArB,CAAX,CAApB;AACA,IAAMC,YAAY,GAAGJ,IAAI,CAACC,KAAL,CAAWC,YAAY,CAACC,OAAb,CAAqB,cAArB,CAAX,CAArB,C,CAEA;;AACA,OAAO,SAASE,YAAT,OAAoC;AAAA,MAAZC,QAAY,QAAZA,QAAY;;AACzC;AACA;AACA;AAHyC,kBAIKd,QAAQ,CAACO,WAAW,KAAK,IAAjB,CAJb;AAAA;AAAA,MAIlCQ,eAJkC;AAAA,MAIjBC,kBAJiB;;AAAA,mBAKjBhB,QAAQ,CAACO,WAAW,IAAIA,WAAW,CAACU,IAA5B,CALS;AAAA;AAAA,MAKlCA,IALkC;AAAA,MAK5BC,OAL4B;;AAAA,mBAMflB,QAAQ,CAACY,YAAY,IAAIA,YAAY,CAACO,KAA9B,CANO;AAAA;AAAA,MAMlCA,KANkC;AAAA,MAM3BC,QAN2B;;AAQzC,MAAMC,OAAO,GAAGnB,UAAU,EAA1B,CARyC,CAUzC;AACA;AACA;;AACA,MAAMoB,MAAM,GAAG,SAATA,MAAS;AAAA;;AAAA;AAAA;AAAA;AAAA;AAASC,YAAAA,KAAT,SAASA,KAAT,EAAgBC,QAAhB,SAAgBA,QAAhB;AAAA;AAAA;AAAA,6CAIDrB,KAAK,CAACoB,KAAD,EAAQC,QAAR,CAJJ;;AAAA;AAAA;AAAA,+BAGTC,IAHS;AAGDC,YAAAA,WAHC,cAGDA,WAHC;AAGYC,YAAAA,QAHZ,cAGYA,QAHZ;AAKXT,YAAAA,OAAO,CAACK,KAAD,CAAP;AACAH,YAAAA,QAAQ,CAACM,WAAD,CAAR;AAEAV,YAAAA,kBAAkB,CAAC,IAAD,CAAlB;;AACA,gBAAIU,WAAJ,EAAiB;AACf,kBAAGH,KAAK,IAAG,mBAAX,EAA+B;AAC/BF,gBAAAA,OAAO,CAACO,IAAR,CAAa,QAAb;AACC,eAFD,MAEK;AACLP,gBAAAA,OAAO,CAACO,IAAR,CAAa,OAAb;AACD;AACA;;AAfU;AAAA;;AAAA;AAAA;AAAA;AAAA,6CAiBJC,OAAO,CAACC,MAAR,aAjBI;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAf,CAbyC,CAkCzC;;;AACA,MAAMC,MAAM,GAAG,SAATA,MAAS;AAAA;AAAA;AAAA;AAAA;AAAA;AACbC,YAAAA,SADa,SACbA,SADa,EAEbC,QAFa,SAEbA,QAFa,EAGbV,KAHa,SAGbA,KAHa,EAIbC,QAJa,SAIbA,QAJa,EAKbU,MALa,SAKbA,MALa,EAMbC,GANa,SAMbA,GANa,EAObC,OAPa,SAObA,OAPa,EAQbC,UARa,SAQbA,UARa,EASbC,KATa,SASbA,KATa,EAUbC,MAVa,SAUbA,MAVa;AAAA;AAAA;AAAA,6CAaLnC,QAAQ,CAAC;AACb4B,cAAAA,SAAS,EAATA,SADa;AAEbC,cAAAA,QAAQ,EAARA,QAFa;AAGbV,cAAAA,KAAK,EAALA,KAHa;AAIbC,cAAAA,QAAQ,EAARA,QAJa;AAKbU,cAAAA,MAAM,EAANA,MALa;AAMbC,cAAAA,GAAG,EAAHA,GANa;AAObC,cAAAA,OAAO,EAAPA,OAPa;AAQbC,cAAAA,UAAU,EAAVA,UARa;AASbC,cAAAA,KAAK,EAALA,KATa;AAUbC,cAAAA,MAAM,EAANA;AAVa,aAAD,CAbH;;AAAA;AAyBX;AACAC,YAAAA,MAAM,CAACC,KAAP,CAAa,6BAAb;AACApB,YAAAA,OAAO,CAACO,IAAR,CAAa,GAAb;AA3BW;AAAA;;AAAA;AAAA;AAAA;AAAA,8CA6BJC,OAAO,CAACC,MAAR,cA7BI;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAf,CAnCyC,CAoEzC;;;AACA,MAAMY,MAAM,GAAG,SAATA,MAAS,GAAM;AACnBxB,IAAAA,OAAO,CAAC,IAAD,CAAP;AACAF,IAAAA,kBAAkB,CAAC,KAAD,CAAlB;AACAN,IAAAA,YAAY,CAACiC,UAAb,CAAwB,aAAxB;AACD,GAJD,CArEyC,CA2EzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,SACE,oBAAC,WAAD,CAAa,QAAb;AACE,IAAA,KAAK,EAAE;AACL5B,MAAAA,eAAe,EAAfA,eADK;AAELC,MAAAA,kBAAkB,EAAlBA,kBAFK;AAGLM,MAAAA,MAAM,EAANA,MAHK;AAILL,MAAAA,IAAI,EAAJA,IAJK;AAKLE,MAAAA,KAAK,EAALA,KALK;AAMLY,MAAAA,MAAM,EAANA,MANK;AAOLW,MAAAA,MAAM,EAANA;AAPK,KADT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAWG5B,QAXH,CADF;AAeD,C,CAED;AACA;;AACA,OAAO,SAAS8B,OAAT,GAAmB;AACxB,MAAMC,OAAO,GAAG5C,UAAU,CAACI,WAAD,CAA1B;AACA,SAAOwC,OAAP;AACD","sourcesContent":["import React, { useState, useContext } from \"react\";\nimport { useHistory } from \"react-router-dom\";\nimport { login } from \"../../axios/login\";\nimport { register } from \"../../axios/register\";\n\n// 1) Creamos el contexto\nconst AuthContext = React.createContext();\n\n\n// Recuperamos el token del localStorage ya que si el usuario\n// refresca la página del navegador necesito iniciar la aplicación\n// con un estado autenticado\nconst currentUser = JSON.parse(localStorage.getItem(\"currentUser\"));\nconst currentToken = JSON.parse(localStorage.getItem(\"currentToken\"));\n\n// 2) Creamos el custom Provider\nexport function AuthProvider({ children }) {\n  // 2.1) Creamos Estados\n  // En caso de que trabaje con roles deberia decodificar el token para obtener el role inicial\n  // const [role, setRole] = useState(decodeTokenAndGetRole(currentUser.token));\n  const [isAuthenticated, setIsAuthenticated] = useState(currentUser !== null);\n  const [user, setUser] = useState(currentUser && currentUser.user);\n  const [token, setToken] = useState(currentToken && currentToken.token);\n\n  const history = useHistory();\n\n  // 2.2) Definiremos los métodos para modificar el estado\n  // Login => Cambiaré a true mi estado\n  // Si trabajo con roles puedo establecer el role a través de la decodificación del token\n  const singIN = async ({ email, password }) => {\n    try {\n      const {\n        data: { accessToken, expireIN }\n      } = await login(email, password);\n      setUser(email);\n      setToken(accessToken);\n\n      setIsAuthenticated(true);\n      if (accessToken) {\n        if(email ==\"admin@yopmail.com\"){\n        history.push(\"/admin\")\n        }else{\n        history.push(\"/user\");\n      }\n      }\n    } catch (error) {\n      return Promise.reject(error);\n    }\n  };\n\n  // Register => Cambiaré a true mi estado\n  const signUp = async ({\n    firstName,\n    lastName,\n    email,\n    password,\n    gender,\n    dob,\n    address,\n    postalCode,\n    phone,\n    bornIn,\n  }) => {\n    try {\n      await register({\n        firstName,\n        lastName,\n        email,\n        password,\n        gender,\n        dob,\n        address,\n        postalCode,\n        phone,\n        bornIn,\n      });\n      ;\n      window.alert(\"Su registro a sido un exito\");\n      history.push(\"/\");\n    } catch (error) {\n      return Promise.reject(error);\n    }\n  };\n\n  // Logout => Cambiaré a false mi estado\n  const logout = () => {\n    setUser(null);\n    setIsAuthenticated(false);\n    localStorage.removeItem(\"currentUser\");\n  };\n\n  // 2.3) Devolvemos el Context\n  // Si usara roles puedo devolver el role actual del usuario en lugar de isAuthenticated\n  // return (\n  //   <AuthContext.Provider\n  //     value={{ role, setRole, signIn, user }}\n  //   >\n  //     {children}\n  //   </AuthContext.Provider>\n  // );\n  return (\n    <AuthContext.Provider\n      value={{\n        isAuthenticated,\n        setIsAuthenticated,\n        singIN,\n        user,\n        token,\n        signUp,\n        logout\n      }}\n    >\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\n// 3) Crear el custom hook\n// Es lo que usaré en los componentes para acceder al value del contexto\nexport function useAuth() {\n  const context = useContext(AuthContext);\n  return context;\n}\n"]},"metadata":{},"sourceType":"module"}